[gcode_macro heat_soak]
gcode:
    {% set CHAMBER = params.CHAMBER|default(45)|float %}
    {% set FRAME = params.FRAME|default(31)|float %}
    {% if not printer["temperature_sensor chamber"].temperature >= CHAMBER or printer["temperature_sensor frame"].temperature >= FRAME %}
    status_busy
    M117 Heat soaking started
    RESPOND MSG="Heat soaking started."
    G28
    G1 X150 Y150 F5000
    M106 S255
    M190 S120
    TEMPERATURE_WAIT SENSOR=heater_bed MAXIMUM=120
    SET_PIN PIN=nevermore VALUE=1
    RESPOND MSG="Nevermore ON."
    SET_FAN_SPEED FAN=exhaust_fan SPEED=0
    TEMPERATURE_WAIT SENSOR="temperature_sensor chamber" MINIMUM={CHAMBER}
    RESPOND MSG="Chamber reached {CHAMBER} degrees."
    TEMPERATURE_WAIT SENSOR="temperature_sensor frame" MINIMUM={FRAME}
    RESPOND MSG="Frame reached {FRAME} degrees."
    status_ready
    {% else %}
    M117 Chamber and frame at or above temp.
    RESPOND MSG="Chamber and frame at or above temp."
    status_ready
    {% endif %}