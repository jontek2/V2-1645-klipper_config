[gcode_macro heat_soak]
gcode:
    {% set TEMP = params.TEMP|default(45)|float %}
    {% if not printer["temperature_sensor chamber"].temperature >= TEMP %}
    M117 Heat soaking started
    RESPOND MSG="Heat soaking started."
    G28
    G1 X150 Y150 F5000
    M190 S110
    SET_FAN_SPEED FAN=nevermore SPEED=1
    M106 S255
    TEMPERATURE_WAIT SENSOR=heater_bed MAXIMUM=110
    TEMPERATURE_WAIT SENSOR="temperature_sensor chamber" MINIMUM={TEMP}
    RESPOND MSG="Chamber reached {TEMP} degrees."
    {% else %}
    M117 Chamber at or above temp.
    RESPOND MSG="Chamber at or above temp."
    {% endif %}